"use strict";
const electron = require("electron");
const node_url = require("node:url");
const node_path = require("node:path");
const node_process = require("node:process");
const ALLOWED_ORIGINS_AND_PERMISSIONS = /* @__PURE__ */ new Map(
  [[new node_url.URL("http://localhost:5173/").origin, /* @__PURE__ */ new Set()]]
);
const ALLOWED_EXTERNAL_ORIGINS = /* @__PURE__ */ new Set(["https://github.com"]);
electron.app.on("web-contents-created", (_, contents) => {
  contents.on("will-navigate", (event, url) => {
    const { origin } = new node_url.URL(url);
    if (ALLOWED_ORIGINS_AND_PERMISSIONS.has(origin)) {
      return;
    }
    event.preventDefault();
    {
      console.warn(`Blocked navigating to disallowed origin: ${origin}`);
    }
  });
  contents.session.setPermissionRequestHandler((webContents, permission, callback) => {
    const { origin } = new node_url.URL(webContents.getURL());
    const permissionGranted = !!ALLOWED_ORIGINS_AND_PERMISSIONS.get(origin)?.has(permission);
    callback(permissionGranted);
    if (!permissionGranted && true) {
      console.warn(`${origin} requested permission for '${permission}', but was rejected.`);
    }
  });
  contents.setWindowOpenHandler(({ url }) => {
    const { origin } = new node_url.URL(url);
    if (ALLOWED_EXTERNAL_ORIGINS.has(origin)) {
      electron.shell.openExternal(url).catch(console.error);
    } else {
      console.warn(`Blocked the opening of a disallowed origin: ${origin}`);
    }
    return { action: "deny" };
  });
  contents.on("will-attach-webview", (event, webPreferences, params) => {
    const { origin } = new node_url.URL(params.src);
    if (!ALLOWED_ORIGINS_AND_PERMISSIONS.has(origin)) {
      {
        console.warn(`A webview tried to attach ${params.src}, but was blocked.`);
      }
      event.preventDefault();
      return;
    }
    delete webPreferences.preload;
    delete webPreferences.preloadURL;
    webPreferences.nodeIntegration = false;
    webPreferences.contextIsolation = true;
  });
});
async function createWindow() {
  const browserWindow = new electron.BrowserWindow({
    show: false,
    // Use the 'ready-to-show' event to show the instantiated BrowserWindow.
    webPreferences: {
      nodeIntegration: false,
      contextIsolation: true,
      sandbox: false,
      // Sandbox disabled because the demo of preload script depend on the Node.js api
      webviewTag: false,
      // The webview tag is not recommended. Consider alternatives like an iframe or Electron's BrowserView. @see https://www.electronjs.org/docs/latest/api/webview-tag#warning
      preload: node_path.join(electron.app.getAppPath(), "packages/preload/dist/index.cjs")
    }
  });
  browserWindow.on("ready-to-show", () => {
    browserWindow?.show();
    {
      browserWindow?.webContents.openDevTools();
    }
  });
  const pageUrl = "http://localhost:5173/";
  await browserWindow.loadURL(pageUrl);
  return browserWindow;
}
async function restoreOrCreateWindow() {
  let window = electron.BrowserWindow.getAllWindows().find((w) => !w.isDestroyed());
  if (window === void 0) {
    window = await createWindow();
  }
  if (window.isMinimized()) {
    window.restore();
  }
  window.focus();
}
const isSingleInstance = electron.app.requestSingleInstanceLock();
if (!isSingleInstance) {
  electron.app.quit();
  process.exit(0);
}
electron.app.on("second-instance", restoreOrCreateWindow);
electron.app.disableHardwareAcceleration();
electron.app.on("window-all-closed", () => {
  if (node_process.platform !== "darwin") {
    electron.app.quit();
  }
});
electron.app.on("activate", restoreOrCreateWindow);
electron.app.whenReady().then(restoreOrCreateWindow).catch((e) => console.error("Failed create window:", e));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguY2pzIiwic291cmNlcyI6WyIuLi9zcmMvc2VjdXJpdHktcmVzdHJpY3Rpb25zLnRzIiwiLi4vc3JjL21haW5XaW5kb3cudHMiLCIuLi9zcmMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUge1Nlc3Npb259IGZyb20gJ2VsZWN0cm9uJztcbmltcG9ydCB7YXBwLCBzaGVsbH0gZnJvbSAnZWxlY3Ryb24nO1xuaW1wb3J0IHtVUkx9IGZyb20gJ25vZGU6dXJsJztcblxuLyoqXG4gKiBVbmlvbiBmb3IgYWxsIGV4aXN0aW5nIHBlcm1pc3Npb25zIGluIGVsZWN0cm9uXG4gKi9cbnR5cGUgUGVybWlzc2lvbiA9IFBhcmFtZXRlcnM8XG4gIEV4Y2x1ZGU8UGFyYW1ldGVyczxTZXNzaW9uWydzZXRQZXJtaXNzaW9uUmVxdWVzdEhhbmRsZXInXT5bMF0sIG51bGw+XG4+WzFdO1xuXG4vKipcbiAqIEEgbGlzdCBvZiBvcmlnaW5zIHRoYXQgeW91IGFsbG93IG9wZW4gSU5TSURFIHRoZSBhcHBsaWNhdGlvbiBhbmQgcGVybWlzc2lvbnMgZm9yIHRoZW0uXG4gKlxuICogSW4gZGV2ZWxvcG1lbnQgbW9kZSB5b3UgbmVlZCBhbGxvdyBvcGVuIGBWSVRFX0RFVl9TRVJWRVJfVVJMYC5cbiAqL1xuY29uc3QgQUxMT1dFRF9PUklHSU5TX0FORF9QRVJNSVNTSU9OUyA9IG5ldyBNYXA8c3RyaW5nLCBTZXQ8UGVybWlzc2lvbj4+KFxuICBpbXBvcnQubWV0YS5lbnYuREVWICYmIGltcG9ydC5tZXRhLmVudi5WSVRFX0RFVl9TRVJWRVJfVVJMXG4gICAgPyBbW25ldyBVUkwoaW1wb3J0Lm1ldGEuZW52LlZJVEVfREVWX1NFUlZFUl9VUkwpLm9yaWdpbiwgbmV3IFNldCgpXV1cbiAgICA6IFtdLFxuKTtcblxuLyoqXG4gKiBBIGxpc3Qgb2Ygb3JpZ2lucyB0aGF0IHlvdSBhbGxvdyBvcGVuIElOIEJST1dTRVIuXG4gKiBOYXZpZ2F0aW9uIHRvIHRoZSBvcmlnaW5zIGJlbG93IGlzIG9ubHkgcG9zc2libGUgaWYgdGhlIGxpbmsgb3BlbnMgaW4gYSBuZXcgd2luZG93LlxuICpcbiAqIEBleGFtcGxlXG4gKiA8YVxuICogICB0YXJnZXQ9XCJfYmxhbmtcIlxuICogICBocmVmPVwiaHR0cHM6Ly9naXRodWIuY29tL1wiXG4gKiA+XG4gKi9cbmNvbnN0IEFMTE9XRURfRVhURVJOQUxfT1JJR0lOUyA9IG5ldyBTZXQ8YGh0dHBzOi8vJHtzdHJpbmd9YD4oWydodHRwczovL2dpdGh1Yi5jb20nXSk7XG5cbmFwcC5vbignd2ViLWNvbnRlbnRzLWNyZWF0ZWQnLCAoXywgY29udGVudHMpID0+IHtcbiAgLyoqXG4gICAqIEJsb2NrIG5hdmlnYXRpb24gdG8gb3JpZ2lucyBub3Qgb24gdGhlIGFsbG93bGlzdC5cbiAgICpcbiAgICogTmF2aWdhdGlvbiBleHBsb2l0cyBhcmUgcXVpdGUgY29tbW9uLiBJZiBhbiBhdHRhY2tlciBjYW4gY29udmluY2UgdGhlIGFwcCB0byBuYXZpZ2F0ZSBhd2F5IGZyb20gaXRzIGN1cnJlbnQgcGFnZSxcbiAgICogdGhleSBjYW4gcG9zc2libHkgZm9yY2UgdGhlIGFwcCB0byBvcGVuIGFyYml0cmFyeSB3ZWIgcmVzb3VyY2VzL3dlYnNpdGVzIG9uIHRoZSB3ZWIuXG4gICAqXG4gICAqIEBzZWUgaHR0cHM6Ly93d3cuZWxlY3Ryb25qcy5vcmcvZG9jcy9sYXRlc3QvdHV0b3JpYWwvc2VjdXJpdHkjMTMtZGlzYWJsZS1vci1saW1pdC1uYXZpZ2F0aW9uXG4gICAqL1xuICBjb250ZW50cy5vbignd2lsbC1uYXZpZ2F0ZScsIChldmVudCwgdXJsKSA9PiB7XG4gICAgY29uc3Qge29yaWdpbn0gPSBuZXcgVVJMKHVybCk7XG4gICAgaWYgKEFMTE9XRURfT1JJR0lOU19BTkRfUEVSTUlTU0lPTlMuaGFzKG9yaWdpbikpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBQcmV2ZW50IG5hdmlnYXRpb25cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgaWYgKGltcG9ydC5tZXRhLmVudi5ERVYpIHtcbiAgICAgIGNvbnNvbGUud2FybihgQmxvY2tlZCBuYXZpZ2F0aW5nIHRvIGRpc2FsbG93ZWQgb3JpZ2luOiAke29yaWdpbn1gKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBCbG9jayByZXF1ZXN0cyBmb3IgZGlzYWxsb3dlZCBwZXJtaXNzaW9ucy5cbiAgICogQnkgZGVmYXVsdCwgRWxlY3Ryb24gd2lsbCBhdXRvbWF0aWNhbGx5IGFwcHJvdmUgYWxsIHBlcm1pc3Npb24gcmVxdWVzdHMuXG4gICAqXG4gICAqIEBzZWUgaHR0cHM6Ly93d3cuZWxlY3Ryb25qcy5vcmcvZG9jcy9sYXRlc3QvdHV0b3JpYWwvc2VjdXJpdHkjNS1oYW5kbGUtc2Vzc2lvbi1wZXJtaXNzaW9uLXJlcXVlc3RzLWZyb20tcmVtb3RlLWNvbnRlbnRcbiAgICovXG4gIGNvbnRlbnRzLnNlc3Npb24uc2V0UGVybWlzc2lvblJlcXVlc3RIYW5kbGVyKCh3ZWJDb250ZW50cywgcGVybWlzc2lvbiwgY2FsbGJhY2spID0+IHtcbiAgICBjb25zdCB7b3JpZ2lufSA9IG5ldyBVUkwod2ViQ29udGVudHMuZ2V0VVJMKCkpO1xuXG4gICAgY29uc3QgcGVybWlzc2lvbkdyYW50ZWQgPSAhIUFMTE9XRURfT1JJR0lOU19BTkRfUEVSTUlTU0lPTlMuZ2V0KG9yaWdpbik/LmhhcyhwZXJtaXNzaW9uKTtcbiAgICBjYWxsYmFjayhwZXJtaXNzaW9uR3JhbnRlZCk7XG5cbiAgICBpZiAoIXBlcm1pc3Npb25HcmFudGVkICYmIGltcG9ydC5tZXRhLmVudi5ERVYpIHtcbiAgICAgIGNvbnNvbGUud2FybihgJHtvcmlnaW59IHJlcXVlc3RlZCBwZXJtaXNzaW9uIGZvciAnJHtwZXJtaXNzaW9ufScsIGJ1dCB3YXMgcmVqZWN0ZWQuYCk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogSHlwZXJsaW5rcyBsZWFkaW5nIHRvIGFsbG93ZWQgc2l0ZXMgYXJlIG9wZW5lZCBpbiB0aGUgZGVmYXVsdCBicm93c2VyLlxuICAgKlxuICAgKiBUaGUgY3JlYXRpb24gb2YgbmV3IGB3ZWJDb250ZW50c2AgaXMgYSBjb21tb24gYXR0YWNrIHZlY3Rvci4gQXR0YWNrZXJzIGF0dGVtcHQgdG8gY29udmluY2UgdGhlIGFwcCB0byBjcmVhdGUgbmV3IHdpbmRvd3MsXG4gICAqIGZyYW1lcywgb3Igb3RoZXIgcmVuZGVyZXIgcHJvY2Vzc2VzIHdpdGggbW9yZSBwcml2aWxlZ2VzIHRoYW4gdGhleSBoYWQgYmVmb3JlOyBvciB3aXRoIHBhZ2VzIG9wZW5lZCB0aGF0IHRoZXkgY291bGRuJ3Qgb3BlbiBiZWZvcmUuXG4gICAqIFlvdSBzaG91bGQgZGVueSBhbnkgdW5leHBlY3RlZCB3aW5kb3cgY3JlYXRpb24uXG4gICAqXG4gICAqIEBzZWUgaHR0cHM6Ly93d3cuZWxlY3Ryb25qcy5vcmcvZG9jcy9sYXRlc3QvdHV0b3JpYWwvc2VjdXJpdHkjMTQtZGlzYWJsZS1vci1saW1pdC1jcmVhdGlvbi1vZi1uZXctd2luZG93c1xuICAgKiBAc2VlIGh0dHBzOi8vd3d3LmVsZWN0cm9uanMub3JnL2RvY3MvbGF0ZXN0L3R1dG9yaWFsL3NlY3VyaXR5IzE1LWRvLW5vdC11c2Utb3BlbmV4dGVybmFsLXdpdGgtdW50cnVzdGVkLWNvbnRlbnRcbiAgICovXG4gIGNvbnRlbnRzLnNldFdpbmRvd09wZW5IYW5kbGVyKCh7dXJsfSkgPT4ge1xuICAgIGNvbnN0IHtvcmlnaW59ID0gbmV3IFVSTCh1cmwpO1xuXG4gICAgaWYgKEFMTE9XRURfRVhURVJOQUxfT1JJR0lOUy5oYXMob3JpZ2luIGFzIGBodHRwczovLyR7c3RyaW5nfWApKSB7XG4gICAgICAvLyBPcGVuIHVybCBpbiBkZWZhdWx0IGJyb3dzZXIuXG4gICAgICBzaGVsbC5vcGVuRXh0ZXJuYWwodXJsKS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgICB9IGVsc2UgaWYgKGltcG9ydC5tZXRhLmVudi5ERVYpIHtcbiAgICAgIGNvbnNvbGUud2FybihgQmxvY2tlZCB0aGUgb3BlbmluZyBvZiBhIGRpc2FsbG93ZWQgb3JpZ2luOiAke29yaWdpbn1gKTtcbiAgICB9XG5cbiAgICAvLyBQcmV2ZW50IGNyZWF0aW5nIGEgbmV3IHdpbmRvdy5cbiAgICByZXR1cm4ge2FjdGlvbjogJ2RlbnknfTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIFZlcmlmeSB3ZWJ2aWV3IG9wdGlvbnMgYmVmb3JlIGNyZWF0aW9uLlxuICAgKlxuICAgKiBTdHJpcCBhd2F5IHByZWxvYWQgc2NyaXB0cywgZGlzYWJsZSBOb2RlLmpzIGludGVncmF0aW9uLCBhbmQgZW5zdXJlIG9yaWdpbnMgYXJlIG9uIHRoZSBhbGxvd2xpc3QuXG4gICAqXG4gICAqIEBzZWUgaHR0cHM6Ly93d3cuZWxlY3Ryb25qcy5vcmcvZG9jcy9sYXRlc3QvdHV0b3JpYWwvc2VjdXJpdHkjMTItdmVyaWZ5LXdlYnZpZXctb3B0aW9ucy1iZWZvcmUtY3JlYXRpb25cbiAgICovXG4gIGNvbnRlbnRzLm9uKCd3aWxsLWF0dGFjaC13ZWJ2aWV3JywgKGV2ZW50LCB3ZWJQcmVmZXJlbmNlcywgcGFyYW1zKSA9PiB7XG4gICAgY29uc3Qge29yaWdpbn0gPSBuZXcgVVJMKHBhcmFtcy5zcmMpO1xuICAgIGlmICghQUxMT1dFRF9PUklHSU5TX0FORF9QRVJNSVNTSU9OUy5oYXMob3JpZ2luKSkge1xuICAgICAgaWYgKGltcG9ydC5tZXRhLmVudi5ERVYpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBBIHdlYnZpZXcgdHJpZWQgdG8gYXR0YWNoICR7cGFyYW1zLnNyY30sIGJ1dCB3YXMgYmxvY2tlZC5gKTtcbiAgICAgIH1cblxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBTdHJpcCBhd2F5IHByZWxvYWQgc2NyaXB0cyBpZiB1bnVzZWQgb3IgdmVyaWZ5IHRoZWlyIGxvY2F0aW9uIGlzIGxlZ2l0aW1hdGUuXG4gICAgZGVsZXRlIHdlYlByZWZlcmVuY2VzLnByZWxvYWQ7XG4gICAgLy8gQHRzLWV4cGVjdC1lcnJvciBgcHJlbG9hZFVSTGAgZXhpc3RzLiAtIEBzZWUgaHR0cHM6Ly93d3cuZWxlY3Ryb25qcy5vcmcvZG9jcy9sYXRlc3QvYXBpL3dlYi1jb250ZW50cyNldmVudC13aWxsLWF0dGFjaC13ZWJ2aWV3XG4gICAgZGVsZXRlIHdlYlByZWZlcmVuY2VzLnByZWxvYWRVUkw7XG5cbiAgICAvLyBEaXNhYmxlIE5vZGUuanMgaW50ZWdyYXRpb25cbiAgICB3ZWJQcmVmZXJlbmNlcy5ub2RlSW50ZWdyYXRpb24gPSBmYWxzZTtcblxuICAgIC8vIEVuYWJsZSBjb250ZXh0SXNvbGF0aW9uXG4gICAgd2ViUHJlZmVyZW5jZXMuY29udGV4dElzb2xhdGlvbiA9IHRydWU7XG4gIH0pO1xufSk7XG4iLCJpbXBvcnQge2FwcCwgQnJvd3NlcldpbmRvd30gZnJvbSAnZWxlY3Ryb24nO1xuaW1wb3J0IHtqb2lufSBmcm9tICdub2RlOnBhdGgnO1xuaW1wb3J0IHtVUkx9IGZyb20gJ25vZGU6dXJsJztcblxuYXN5bmMgZnVuY3Rpb24gY3JlYXRlV2luZG93KCkge1xuICBjb25zdCBicm93c2VyV2luZG93ID0gbmV3IEJyb3dzZXJXaW5kb3coe1xuICAgIHNob3c6IGZhbHNlLCAvLyBVc2UgdGhlICdyZWFkeS10by1zaG93JyBldmVudCB0byBzaG93IHRoZSBpbnN0YW50aWF0ZWQgQnJvd3NlcldpbmRvdy5cbiAgICB3ZWJQcmVmZXJlbmNlczoge1xuICAgICAgbm9kZUludGVncmF0aW9uOiBmYWxzZSxcbiAgICAgIGNvbnRleHRJc29sYXRpb246IHRydWUsXG4gICAgICBzYW5kYm94OiBmYWxzZSwgLy8gU2FuZGJveCBkaXNhYmxlZCBiZWNhdXNlIHRoZSBkZW1vIG9mIHByZWxvYWQgc2NyaXB0IGRlcGVuZCBvbiB0aGUgTm9kZS5qcyBhcGlcbiAgICAgIHdlYnZpZXdUYWc6IGZhbHNlLCAvLyBUaGUgd2VidmlldyB0YWcgaXMgbm90IHJlY29tbWVuZGVkLiBDb25zaWRlciBhbHRlcm5hdGl2ZXMgbGlrZSBhbiBpZnJhbWUgb3IgRWxlY3Ryb24ncyBCcm93c2VyVmlldy4gQHNlZSBodHRwczovL3d3dy5lbGVjdHJvbmpzLm9yZy9kb2NzL2xhdGVzdC9hcGkvd2Vidmlldy10YWcjd2FybmluZ1xuICAgICAgcHJlbG9hZDogam9pbihhcHAuZ2V0QXBwUGF0aCgpLCAncGFja2FnZXMvcHJlbG9hZC9kaXN0L2luZGV4LmNqcycpLFxuICAgIH0sXG4gIH0pO1xuXG4gIC8qKlxuICAgKiBJZiB0aGUgJ3Nob3cnIHByb3BlcnR5IG9mIHRoZSBCcm93c2VyV2luZG93J3MgY29uc3RydWN0b3IgaXMgb21pdHRlZCBmcm9tIHRoZSBpbml0aWFsaXphdGlvbiBvcHRpb25zLFxuICAgKiBpdCB0aGVuIGRlZmF1bHRzIHRvICd0cnVlJy4gVGhpcyBjYW4gY2F1c2UgZmxpY2tlcmluZyBhcyB0aGUgd2luZG93IGxvYWRzIHRoZSBodG1sIGNvbnRlbnQsXG4gICAqIGFuZCBpdCBhbHNvIGhhcyBzaG93IHByb2JsZW1hdGljIGJlaGF2aW91ciB3aXRoIHRoZSBjbG9zaW5nIG9mIHRoZSB3aW5kb3cuXG4gICAqIFVzZSBgc2hvdzogZmFsc2VgIGFuZCBsaXN0ZW4gdG8gdGhlICBgcmVhZHktdG8tc2hvd2AgZXZlbnQgdG8gc2hvdyB0aGUgd2luZG93LlxuICAgKlxuICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9lbGVjdHJvbi9lbGVjdHJvbi9pc3N1ZXMvMjUwMTIgZm9yIHRoZSBhZmZvcmQgbWVudGlvbmVkIGlzc3VlLlxuICAgKi9cbiAgYnJvd3NlcldpbmRvdy5vbigncmVhZHktdG8tc2hvdycsICgpID0+IHtcbiAgICBicm93c2VyV2luZG93Py5zaG93KCk7XG5cbiAgICBpZiAoaW1wb3J0Lm1ldGEuZW52LkRFVikge1xuICAgICAgYnJvd3NlcldpbmRvdz8ud2ViQ29udGVudHMub3BlbkRldlRvb2xzKCk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogVVJMIGZvciBtYWluIHdpbmRvdy5cbiAgICogVml0ZSBkZXYgc2VydmVyIGZvciBkZXZlbG9wbWVudC5cbiAgICogYGZpbGU6Ly8uLi9yZW5kZXJlci9pbmRleC5odG1sYCBmb3IgcHJvZHVjdGlvbiBhbmQgdGVzdC5cbiAgICovXG4gIGNvbnN0IHBhZ2VVcmwgPVxuICAgIGltcG9ydC5tZXRhLmVudi5ERVYgJiYgaW1wb3J0Lm1ldGEuZW52LlZJVEVfREVWX1NFUlZFUl9VUkwgIT09IHVuZGVmaW5lZFxuICAgICAgPyBpbXBvcnQubWV0YS5lbnYuVklURV9ERVZfU0VSVkVSX1VSTFxuICAgICAgOiBuZXcgVVJMKCcuLi9yZW5kZXJlci9kaXN0L2luZGV4Lmh0bWwnLCAnZmlsZTovLycgKyBfX2Rpcm5hbWUpLnRvU3RyaW5nKCk7XG5cbiAgYXdhaXQgYnJvd3NlcldpbmRvdy5sb2FkVVJMKHBhZ2VVcmwpO1xuXG4gIHJldHVybiBicm93c2VyV2luZG93O1xufVxuXG4vKipcbiAqIFJlc3RvcmUgYW4gZXhpc3RpbmcgQnJvd3NlcldpbmRvdyBvciBDcmVhdGUgYSBuZXcgQnJvd3NlcldpbmRvdy5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlc3RvcmVPckNyZWF0ZVdpbmRvdygpIHtcbiAgbGV0IHdpbmRvdyA9IEJyb3dzZXJXaW5kb3cuZ2V0QWxsV2luZG93cygpLmZpbmQodyA9PiAhdy5pc0Rlc3Ryb3llZCgpKTtcblxuICBpZiAod2luZG93ID09PSB1bmRlZmluZWQpIHtcbiAgICB3aW5kb3cgPSBhd2FpdCBjcmVhdGVXaW5kb3coKTtcbiAgfVxuXG4gIGlmICh3aW5kb3cuaXNNaW5pbWl6ZWQoKSkge1xuICAgIHdpbmRvdy5yZXN0b3JlKCk7XG4gIH1cblxuICB3aW5kb3cuZm9jdXMoKTtcbn1cbiIsImltcG9ydCB7YXBwfSBmcm9tICdlbGVjdHJvbic7XG5pbXBvcnQgJy4vc2VjdXJpdHktcmVzdHJpY3Rpb25zJztcbmltcG9ydCB7cmVzdG9yZU9yQ3JlYXRlV2luZG93fSBmcm9tICcvQC9tYWluV2luZG93JztcbmltcG9ydCB7cGxhdGZvcm19IGZyb20gJ25vZGU6cHJvY2Vzcyc7XG5cbi8qKlxuICogUHJldmVudCBlbGVjdHJvbiBmcm9tIHJ1bm5pbmcgbXVsdGlwbGUgaW5zdGFuY2VzLlxuICovXG5jb25zdCBpc1NpbmdsZUluc3RhbmNlID0gYXBwLnJlcXVlc3RTaW5nbGVJbnN0YW5jZUxvY2soKTtcbmlmICghaXNTaW5nbGVJbnN0YW5jZSkge1xuICBhcHAucXVpdCgpO1xuICBwcm9jZXNzLmV4aXQoMCk7XG59XG5hcHAub24oJ3NlY29uZC1pbnN0YW5jZScsIHJlc3RvcmVPckNyZWF0ZVdpbmRvdyk7XG5cbi8qKlxuICogRGlzYWJsZSBIYXJkd2FyZSBBY2NlbGVyYXRpb24gdG8gc2F2ZSBtb3JlIHN5c3RlbSByZXNvdXJjZXMuXG4gKi9cbmFwcC5kaXNhYmxlSGFyZHdhcmVBY2NlbGVyYXRpb24oKTtcblxuLyoqXG4gKiBTaG91dCBkb3duIGJhY2tncm91bmQgcHJvY2VzcyBpZiBhbGwgd2luZG93cyB3YXMgY2xvc2VkXG4gKi9cbmFwcC5vbignd2luZG93LWFsbC1jbG9zZWQnLCAoKSA9PiB7XG4gIGlmIChwbGF0Zm9ybSAhPT0gJ2RhcndpbicpIHtcbiAgICBhcHAucXVpdCgpO1xuICB9XG59KTtcblxuLyoqXG4gKiBAc2VlIGh0dHBzOi8vd3d3LmVsZWN0cm9uanMub3JnL2RvY3MvbGF0ZXN0L2FwaS9hcHAjZXZlbnQtYWN0aXZhdGUtbWFjb3MgRXZlbnQ6ICdhY3RpdmF0ZScuXG4gKi9cbmFwcC5vbignYWN0aXZhdGUnLCByZXN0b3JlT3JDcmVhdGVXaW5kb3cpO1xuXG4vKipcbiAqIENyZWF0ZSB0aGUgYXBwbGljYXRpb24gd2luZG93IHdoZW4gdGhlIGJhY2tncm91bmQgcHJvY2VzcyBpcyByZWFkeS5cbiAqL1xuYXBwXG4gIC53aGVuUmVhZHkoKVxuICAudGhlbihyZXN0b3JlT3JDcmVhdGVXaW5kb3cpXG4gIC5jYXRjaChlID0+IGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCBjcmVhdGUgd2luZG93OicsIGUpKTtcblxuLyoqXG4gKiBJbnN0YWxsIFZ1ZS5qcyBvciBhbnkgb3RoZXIgZXh0ZW5zaW9uIGluIGRldmVsb3BtZW50IG1vZGUgb25seS5cbiAqIE5vdGU6IFlvdSBtdXN0IGluc3RhbGwgYGVsZWN0cm9uLWRldnRvb2xzLWluc3RhbGxlcmAgbWFudWFsbHlcbiAqL1xuLy8gaWYgKGltcG9ydC5tZXRhLmVudi5ERVYpIHtcbi8vICAgYXBwXG4vLyAgICAgLndoZW5SZWFkeSgpXG4vLyAgICAgLnRoZW4oKCkgPT4gaW1wb3J0KCdlbGVjdHJvbi1kZXZ0b29scy1pbnN0YWxsZXInKSlcbi8vICAgICAudGhlbihtb2R1bGUgPT4ge1xuLy8gICAgICAgY29uc3Qge2RlZmF1bHQ6IGluc3RhbGxFeHRlbnNpb24sIFZVRUpTM19ERVZUT09MU30gPVxuLy8gICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIEhvdGZpeCBmb3IgaHR0cHM6Ly9naXRodWIuY29tL2Nhd2EtOTMvdml0ZS1lbGVjdHJvbi1idWlsZGVyL2lzc3Vlcy85MTVcbi8vICAgICAgICAgdHlwZW9mIG1vZHVsZS5kZWZhdWx0ID09PSAnZnVuY3Rpb24nID8gbW9kdWxlIDogKG1vZHVsZS5kZWZhdWx0IGFzIHR5cGVvZiBtb2R1bGUpO1xuLy9cbi8vICAgICAgIHJldHVybiBpbnN0YWxsRXh0ZW5zaW9uKFZVRUpTM19ERVZUT09MUywge1xuLy8gICAgICAgICBsb2FkRXh0ZW5zaW9uT3B0aW9uczoge1xuLy8gICAgICAgICAgIGFsbG93RmlsZUFjY2VzczogdHJ1ZSxcbi8vICAgICAgICAgfSxcbi8vICAgICAgIH0pO1xuLy8gICAgIH0pXG4vLyAgICAgLmNhdGNoKGUgPT4gY29uc29sZS5lcnJvcignRmFpbGVkIGluc3RhbGwgZXh0ZW5zaW9uOicsIGUpKTtcbi8vIH1cblxuLyoqXG4gKiBDaGVjayBmb3IgYXBwIHVwZGF0ZXMsIGluc3RhbGwgaXQgaW4gYmFja2dyb3VuZCBhbmQgbm90aWZ5IHVzZXIgdGhhdCBuZXcgdmVyc2lvbiB3YXMgaW5zdGFsbGVkLlxuICogTm8gcmVhc29uIHJ1biB0aGlzIGluIG5vbi1wcm9kdWN0aW9uIGJ1aWxkLlxuICogQHNlZSBodHRwczovL3d3dy5lbGVjdHJvbi5idWlsZC9hdXRvLXVwZGF0ZS5odG1sI3F1aWNrLXNldHVwLWd1aWRlXG4gKlxuICogTm90ZTogSXQgbWF5IHRocm93IFwiRU5PRU5UOiBubyBzdWNoIGZpbGUgYXBwLXVwZGF0ZS55bWxcIlxuICogaWYgeW91IGNvbXBpbGUgcHJvZHVjdGlvbiBhcHAgd2l0aG91dCBwdWJsaXNoaW5nIGl0IHRvIGRpc3RyaWJ1dGlvbiBzZXJ2ZXIuXG4gKiBMaWtlIGBucG0gcnVuIGNvbXBpbGVgIGRvZXMuIEl0J3Mgb2sg8J+YhVxuICovXG5pZiAoaW1wb3J0Lm1ldGEuZW52LlBST0QpIHtcbiAgYXBwXG4gICAgLndoZW5SZWFkeSgpXG4gICAgLnRoZW4oKCkgPT4gaW1wb3J0KCdlbGVjdHJvbi11cGRhdGVyJykpXG4gICAgLnRoZW4obW9kdWxlID0+IHtcbiAgICAgIGNvbnN0IGF1dG9VcGRhdGVyID1cbiAgICAgICAgbW9kdWxlLmF1dG9VcGRhdGVyIHx8XG4gICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgSG90Zml4IGZvciBodHRwczovL2dpdGh1Yi5jb20vZWxlY3Ryb24tdXNlcmxhbmQvZWxlY3Ryb24tYnVpbGRlci9pc3N1ZXMvNzMzOFxuICAgICAgICAobW9kdWxlLmRlZmF1bHQuYXV0b1VwZGF0ZXIgYXMgKHR5cGVvZiBtb2R1bGUpWydhdXRvVXBkYXRlciddKTtcbiAgICAgIHJldHVybiBhdXRvVXBkYXRlci5jaGVja0ZvclVwZGF0ZXNBbmROb3RpZnkoKTtcbiAgICB9KVxuICAgIC5jYXRjaChlID0+IGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCBjaGVjayBhbmQgaW5zdGFsbCB1cGRhdGVzOicsIGUpKTtcbn1cbiJdLCJuYW1lcyI6WyJVUkwiLCJhcHAiLCJzaGVsbCIsIkJyb3dzZXJXaW5kb3ciLCJq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
